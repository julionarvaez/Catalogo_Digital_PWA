<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîî Demostraci√≥n de Notificaciones Push - Alimento del Cielo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .contenedor {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 1rem;
            font-size: 2rem;
        }

        .subtitulo {
            text-align: center;
            color: #718096;
            margin-bottom: 2rem;
        }

        .estado-container {
            background: #f7fafc;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-left: 4px solid #667eea;
        }

        .estado-titulo {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }

        .estado-valor {
            color: #4a5568;
            font-size: 0.95rem;
        }

        .estado-icono {
            font-size: 2rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .botones-demo {
            display: grid;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secundario {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .btn-terciario {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
        }

        .alerta {
            background: #fff5f5;
            border: 2px solid #feb2b2;
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
            color: #c53030;
            display: none;
        }

        .alerta.mostrar {
            display: block;
        }

        .exito {
            background: #f0fff4;
            border-color: #9ae6b4;
            color: #22543d;
        }

        .info {
            background: #ebf8ff;
            border-color: #90cdf4;
            color: #2c5282;
        }

        .log-container {
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 10px;
            padding: 1rem;
            margin-top: 2rem;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }

        .log-titulo {
            color: #a0aec0;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .log-entrada {
            padding: 0.25rem 0;
            border-bottom: 1px solid #4a5568;
        }

        .log-entrada:last-child {
            border-bottom: none;
        }

        .timestamp {
            color: #9ae6b4;
        }

        @media (max-width: 640px) {
            .contenedor {
                padding: 2rem 1.5rem;
            }

            h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="contenedor">
        <h1>üîî Demostraci√≥n de Notificaciones</h1>
        <p class="subtitulo">Prueba el sistema de notificaciones push de Alimento del Cielo</p>

        <!-- Estado actual -->
        <div class="estado-container">
            <div class="estado-icono" id="estadoIcono">‚ùì</div>
            <div class="estado-titulo">Estado de Notificaciones</div>
            <div class="estado-valor" id="estadoTexto">Verificando...</div>
        </div>

        <!-- Alertas -->
        <div class="alerta" id="alerta"></div>

        <!-- Botones de demostraci√≥n -->
        <div class="botones-demo">
            <button class="btn" id="btnSolicitar" onclick="solicitarPermisos()">
                üîî Solicitar Permisos
            </button>

            <button class="btn btn-secundario" id="btnOferta" onclick="enviarNotificacionOferta()" disabled>
                üéÅ Notificaci√≥n de Oferta
            </button>

            <button class="btn btn-terciario" id="btnNuevo" onclick="enviarNotificacionNuevo()" disabled>
                üÜï Producto Nuevo
            </button>

            <button class="btn btn-info" id="btnCarrito" onclick="enviarNotificacionCarrito()" disabled>
                üõí Carrito Recordatorio
            </button>
        </div>

        <!-- Log de eventos -->
        <div class="log-container">
            <div class="log-titulo">üìã Registro de Eventos:</div>
            <div id="logEventos"></div>
        </div>
    </div>

    <script>
        // === FUNCIONES DE LOG ===
        function registrarEvento(mensaje) {
            const log = document.getElementById('logEventos');
            const timestamp = new Date().toLocaleTimeString();
            const entrada = document.createElement('div');
            entrada.className = 'log-entrada';
            entrada.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${mensaje}`;
            log.appendChild(entrada);
            log.scrollTop = log.scrollHeight;
        }

        // === VERIFICAR ESTADO INICIAL ===
        function verificarEstado() {
            const estadoIcono = document.getElementById('estadoIcono');
            const estadoTexto = document.getElementById('estadoTexto');
            const alerta = document.getElementById('alerta');

            if (!('Notification' in window)) {
                estadoIcono.textContent = '‚ùå';
                estadoTexto.textContent = 'Tu navegador no soporta notificaciones';
                mostrarAlerta('Este navegador no soporta notificaciones push.', 'error');
                registrarEvento('‚ùå Notificaciones no soportadas');
                return false;
            }

            const permiso = Notification.permission;
            registrarEvento(`üîç Permiso actual: ${permiso}`);

            if (permiso === 'granted') {
                estadoIcono.textContent = '‚úÖ';
                estadoTexto.textContent = 'Notificaciones ACTIVADAS - ¬°Todo listo!';
                mostrarAlerta('¬°Perfecto! Las notificaciones est√°n activadas.', 'exito');
                habilitarBotones();
            } else if (permiso === 'denied') {
                estadoIcono.textContent = 'üîï';
                estadoTexto.textContent = 'Notificaciones BLOQUEADAS - Act√≠valas en la configuraci√≥n del navegador';
                mostrarAlerta('Las notificaciones est√°n bloqueadas. Act√≠valas en la configuraci√≥n del navegador.', 'error');
            } else {
                estadoIcono.textContent = '‚è≥';
                estadoTexto.textContent = 'Notificaciones DISPONIBLES - Haz clic en "Solicitar Permisos"';
                mostrarAlerta('Haz clic en "Solicitar Permisos" para comenzar.', 'info');
            }

            return permiso === 'granted';
        }

        // === SOLICITAR PERMISOS ===
        async function solicitarPermisos() {
            registrarEvento('üì¨ Solicitando permisos...');
            
            try {
                const permiso = await Notification.requestPermission();
                registrarEvento(`‚úÖ Respuesta del usuario: ${permiso}`);

                if (permiso === 'granted') {
                    mostrarAlerta('¬°Excelente! Notificaciones activadas correctamente.', 'exito');
                    habilitarBotones();
                    
                    // Enviar notificaci√≥n de prueba
                    setTimeout(() => {
                        enviarNotificacionBienvenida();
                    }, 1000);
                } else {
                    mostrarAlerta('Permisos denegados. Puedes intentarlo de nuevo.', 'error');
                }

                verificarEstado();
            } catch (error) {
                registrarEvento(`‚ùå Error: ${error.message}`);
                mostrarAlerta('Error al solicitar permisos: ' + error.message, 'error');
            }
        }

        // === ENVIAR NOTIFICACIONES ===
        function enviarNotificacionBienvenida() {
            registrarEvento('üéâ Enviando notificaci√≥n de bienvenida...');
            
            const notif = new Notification('üéâ ¬°Bienvenido!', {
                body: 'Gracias por activar las notificaciones. Ahora recibir√°s las mejores ofertas.',
                icon: './Imagenes/logo/Logo.png',
                badge: './Imagenes/iconos/96x96/96x96.png',
                vibrate: [200, 100, 200],
                tag: 'bienvenida',
                requireInteraction: false
            });

            notif.onclick = () => {
                registrarEvento('üëÜ Click en notificaci√≥n de bienvenida');
                window.focus();
                notif.close();
            };

            registrarEvento('‚úÖ Notificaci√≥n de bienvenida enviada');
        }

        function enviarNotificacionOferta() {
            registrarEvento('üéÅ Enviando notificaci√≥n de oferta...');
            
            const notif = new Notification('üî• ¬°Oferta Especial!', {
                body: '30% de descuento en todos los productos de pollo. ¬°Solo por hoy!',
                icon: './Imagenes/logo/Logo.png',
                image: './Imagenes/productos/pollo-apanado.png',
                badge: './Imagenes/iconos/96x96/96x96.png',
                vibrate: [200, 100, 200, 100, 200],
                tag: 'oferta-pollo',
                requireInteraction: false,
                actions: [
                    { action: 'ver', title: 'üëÄ Ver Oferta' },
                    { action: 'cerrar', title: '‚úñÔ∏è Cerrar' }
                ]
            });

            notif.onclick = () => {
                registrarEvento('üëÜ Click en notificaci√≥n de oferta');
                alert('¬°Redirigiendo a la oferta!');
                notif.close();
            };

            registrarEvento('‚úÖ Notificaci√≥n de oferta enviada');
        }

        function enviarNotificacionNuevo() {
            registrarEvento('üÜï Enviando notificaci√≥n de producto nuevo...');
            
            const notif = new Notification('üÜï Nuevo Producto Disponible', {
                body: 'Acaba de llegar: Salm√≥n fresco del Atl√°ntico. ¬°Aprovecha esta semana!',
                icon: './Imagenes/logo/Logo.png',
                badge: './Imagenes/iconos/96x96/96x96.png',
                vibrate: [100, 50, 100],
                tag: 'nuevo-salmon',
                requireInteraction: false
            });

            notif.onclick = () => {
                registrarEvento('üëÜ Click en notificaci√≥n de nuevo producto');
                alert('¬°Mostrando producto nuevo!');
                notif.close();
            };

            registrarEvento('‚úÖ Notificaci√≥n de producto nuevo enviada');
        }

        function enviarNotificacionCarrito() {
            registrarEvento('üõí Enviando recordatorio de carrito...');
            
            const notif = new Notification('üõí ¬°No Olvides tu Carrito!', {
                body: 'Tienes 3 productos esperando. Completa tu compra y recibe env√≠o gratis.',
                icon: './Imagenes/logo/Logo.png',
                badge: './Imagenes/iconos/96x96/96x96.png',
                vibrate: [200, 100, 200],
                tag: 'recordatorio-carrito',
                requireInteraction: true // Requiere acci√≥n del usuario
            });

            notif.onclick = () => {
                registrarEvento('üëÜ Click en recordatorio de carrito');
                alert('¬°Abriendo carrito de compras!');
                notif.close();
            };

            registrarEvento('‚úÖ Recordatorio de carrito enviado');
        }

        // === UTILIDADES ===
        function mostrarAlerta(mensaje, tipo = 'info') {
            const alerta = document.getElementById('alerta');
            alerta.textContent = mensaje;
            alerta.className = `alerta mostrar ${tipo}`;
        }

        function habilitarBotones() {
            document.getElementById('btnOferta').disabled = false;
            document.getElementById('btnNuevo').disabled = false;
            document.getElementById('btnCarrito').disabled = false;
            document.getElementById('btnSolicitar').disabled = true;
        }

        // === INICIALIZACI√ìN ===
        window.addEventListener('DOMContentLoaded', () => {
            registrarEvento('üöÄ Iniciando demostraci√≥n de notificaciones...');
            const tienePermisos = verificarEstado();
            
            if (tienePermisos) {
                habilitarBotones();
            }

            registrarEvento('‚úÖ Sistema listo');
        });
    </script>
</body>
</html>
